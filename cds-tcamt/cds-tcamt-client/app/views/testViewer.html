<md-content>
    <md-tabs md-selected="view.tab" md-dynamic-height md-border-bottom>
        <md-tab label="Test Case Information">
            <md-content class="md-padding">
                <div>
                    <h3>Test Case Metadata</h3>
                    <table class="table table-condensed table-striped table-bordered">
                        <tr>
                            <td style="width : 200px;"><strong> Name </strong></td>
                            <td>{{selectedTC.name}}</td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong>Description</strong></td>
                            <td>{{selectedTC.description}}</td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong>Assessment Date</strong></td>
                            <td ng-show="selectedTC.evalDate.type === 'fixed'">
                                {{selectedTC.evalDate.date | date:'MM/dd/yyyy'}}
                            </td>
                            <td ng-show="selectedTC.evalDate.type === 'relative'">
                                Relative
                            </td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Version </strong></td>
                            <td>{{selectedTC.metaData.version}}</td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Date Created </strong></td>
                            <td>{{selectedTC.metaData.dateCreated | date:'MM/dd/yyyy'}}</td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Date Last Updated </strong></td>
                            <td>{{selectedTC.metaData.dateLastUpdated | date:'MM/dd/yyyy'}}</td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Type </strong></td>
                            <td>
                                {{selectedTC.metaData.imported ? 'Imported' : 'Created in FITS'}}
                            </td>
                        </tr>
                    </table>
                    <h3>Assessment Date</h3>
                    <table class="table table-condensed table-striped table-bordered">
                        <tr>
                            <td style="text-align: center;" ng-show="selectedTC.evalDate.type === 'fixed'">
                                {{selectedTC.evalDate.date | date:'MM/dd/yyyy'}} - {{selectedTC.evalDate.date | date : 'fullDate'}}
                            </td>
                            <td style="text-align: center;" ng-show="selectedTC.evalDate.type === 'relative'">
                                Relative
                            </td>
                        </tr>
                    </table>
                    <h3>Patient Information</h3>
                    <table class="table table-condensed table-striped table-bordered">
                        <tr>
                            <td style="width : 200px;"><strong> Gender </strong></td>
                            <td>{{selectedTC.patient.gender === 'F' ? 'Female' : (selectedTC.patient.gender === 'M' ? 'Male' : '') }}</td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Date Of Birth </strong></td>
                            <td ng-if="selectedTC.patient.dob.type === 'fixed'">
                                {{selectedTC.patient.dob.date | date:'MM/dd/yyyy'}}
                            </td>
                            <td ng-if="selectedTC.patient.dob.type === 'relative'">
                                <table ng-if="selectedTC.patient.dob.rules">
                                    <tr ng-repeat="rule in selectedTC.patient.dob.rules track by $index">
                                        <td><span ng-if="$index !== 0"><strong>BUT NOT BEFORE</strong></span></td>
                                        <td>{{rule.year}} <strong>Years</strong></td>
                                        <td>{{rule.month}} <strong>Months</strong></td>
                                        <td>{{rule.day}} <strong>Days</strong></td>
                                        <td><strong>{{rule.position}}</strong></td>
                                        <td>
                                            <div ng-if="rule.relativeTo.reference === 'static'">
                                                {{rule.relativeTo.id === 'DOB' ? 'Birth' : rule.relativeTo.id === 'EVALDATE' ? 'Assessment Date' : '#'}}
                                            </div>
                                            <div ng-if="rule.relativeTo.reference === 'dynamic'">
                                                Vaccination ID # {{rule.relativeTo.id}}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                    <h3 ng-show="selectedTC.events.length > 0" >Vaccination History and Expected Evaluations</h3>
                    <table class="table table-condensed table-striped table-bordered" ng-repeat="event in selectedTC.events track by $index">
                        <tr>
                            <td ng-show="event.vaccination.administred.discriminator === 'generic'" colspan=2 style="color : blue;"><strong># {{event.vaccination.position}} - {{event.vaccination.administred.name}} - CVX : {{event.vaccination.administred.cvx}}</strong></td>
                            <td ng-show="event.vaccination.administred.discriminator === 'specific'" colspan=2 style="color : blue;"><strong># {{event.vaccination.position}} - {{event.vaccination.administred.name}} - </strong>{{getMapping(event.vaccination.administred).vx.name}} <strong> - CVX : {{getMapping(event.vaccination.administred).vx.cvx}} - MVX : {{event.vaccination.administred.mx.mvx}}</strong></td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Date Administred </strong></td>
                            <td ng-if="event.vaccination.date.type === 'fixed'">
                                {{event.vaccination.date.date | date:'MM/dd/yyyy'}}
                            </td>
                            <td ng-if="event.vaccination.date.type === 'relative'">
                                <table ng-if="event.vaccination.date.rules">
                                    <tr ng-repeat="rule in event.vaccination.date.rules track by $index">
                                        <td><span ng-if="$index !== 0"><strong>BUT NOT BEFORE</strong></span></td>
                                        <td>{{rule.year}} <strong>Years</strong></td>
                                        <td>{{rule.month}} <strong>Months</strong></td>
                                        <td>{{rule.day}} <strong>Days</strong></td>
                                        <td><strong>{{rule.position}}</strong></td>
                                        <td>
                                            <div ng-if="rule.relativeTo.reference === 'static'">
                                                {{rule.relativeTo.id === 'DOB' ? 'Birth' : rule.relativeTo.id === 'EVALDATE' ? 'Assessment Date' : '#'}}
                                            </div>
                                            <div ng-if="rule.relativeTo.reference === 'dynamic'">
                                                Vaccination ID # {{rule.relativeTo.id}}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="width : 200px;" ><strong> Evaluations </strong></td>
                            <td>
                                <table class="table table-condensedtable-bordered">
                                    <tr layout="row">
                                        <td flex="10"><strong> CVX </strong></td>
                                        <td flex="40"><strong> Name </strong></td>
                                        <td flex="20"><strong> Status </strong></td>
                                        <td flex="30"><strong> Reason </strong></td>
                                    </tr>
                                    <tr ng-repeat="eval in event.vaccination.evaluations" layout="row">
                                        <td flex="10">{{eval.relatedTo.cvx}}</td>
                                        <td flex="40">{{eval.relatedTo.name}}</td>
                                        <td flex="20">{{valueForEnum(eval.status,evalStatus)}}</td>
                                        <td flex="30">{{valueForEnum(eval.reason,evalReason)}}</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                    <h3 ng-show="selectedTC.forecast.length > 0">Expected Forecasts</h3>
                    <table class="table table-condensed table-striped table-bordered" ng-repeat="fc in selectedTC.forecast track by $index">
                        <tr>
                            <td colspan=2 style="color : blue;"><strong>{{fc.target.name}} # {{fc.target.cvx}}</strong></td>
                        </tr>
                        <tr>
                            <td style="width : 200px;" ><strong> Series Status </strong></td>
                            <td>
                                {{valueForEnum(fc.serieStatus,serieStatus)}}
                            </td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Reason </strong></td>
                            <td>
                                {{fc.forecastReason}}
                            </td>
                        </tr>
                        <tr>
                            <td style="width : 200px;"><strong> Earliest Date </strong></td>
                            <td ng-if="fc.earliest.type === 'fixed'">
                                {{fc.earliest.date | date:'MM/dd/yyyy'}}
                            </td>
                            <td ng-if="fc.earliest.type === 'relative'">
                                <table ng-if="fc.earliest.rules">
                                    <tr ng-repeat="rule in fc.earliest.rules track by $index">
                                        <td><span ng-if="$index !== 0"><strong>BUT NOT BEFORE</strong></span></td>
                                        <td>{{rule.year}} <strong>Years</strong></td>
                                        <td>{{rule.month}} <strong>Months</strong></td>
                                        <td>{{rule.day}} <strong>Days</strong></td>
                                        <td><strong>{{rule.position}}</strong></td>
                                        <td>
                                            <div ng-if="rule.relativeTo.reference === 'static'">
                                                {{rule.relativeTo.id === 'DOB' ? 'Birth' : rule.relativeTo.id === 'EVALDATE' ? 'Assessment Date' : '#'}}
                                            </div>
                                            <div ng-if="rule.relativeTo.reference === 'dynamic'">
                                                Vaccination ID # {{rule.relativeTo.id}}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="width : 200px;" ><strong> Recommended Date </strong></td>
                            <td ng-if="fc.recommended.type === 'fixed'">
                                {{fc.recommended.date | date:'MM/dd/yyyy'}}
                            </td>
                            <td ng-if="fc.recommended.type === 'relative'">
                                <table ng-if="fc.recommended.rules">
                                    <tr ng-repeat="rule in fc.recommended.rules track by $index">
                                        <td><span ng-if="$index !== 0"><strong>BUT NOT BEFORE</strong></span></td>
                                        <td>{{rule.year}} <strong>Years</strong></td>
                                        <td>{{rule.month}} <strong>Months</strong></td>
                                        <td>{{rule.day}} <strong>Days</strong></td>
                                        <td><strong>{{rule.position}}</strong></td>
                                        <td>
                                            <div ng-if="rule.relativeTo.reference === 'static'">
                                                {{rule.relativeTo.id === 'DOB' ? 'Birth' : rule.relativeTo.id === 'EVALDATE' ? 'Assessment Date' : '#'}}
                                            </div>
                                            <div ng-if="rule.relativeTo.reference === 'dynamic'">
                                                Vaccination ID # {{rule.relativeTo.id}}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="width : 200px;" ><strong> Past Due Date </strong></td>
                            <td ng-if="fc.pastDue.type === 'fixed'">
                                {{fc.pastDue.date | date:'MM/dd/yyyy'}}
                            </td>
                            <td ng-if="fc.pastDue.type === 'relative'">
                                <table ng-if="fc.pastDue.rules">
                                    <tr ng-repeat="rule in fc.pastDue.rules track by $index">
                                        <td><span ng-if="$index !== 0"><strong>BUT NOT BEFORE</strong></span></td>
                                        <td>{{rule.year}} <strong>Years</strong></td>
                                        <td>{{rule.month}} <strong>Months</strong></td>
                                        <td>{{rule.day}} <strong>Days</strong></td>
                                        <td><strong>{{rule.position}}</strong></td>
                                        <td>
                                            <div ng-if="rule.relativeTo.reference === 'static'">
                                                {{rule.relativeTo.id === 'DOB' ? 'Birth' : rule.relativeTo.id === 'EVALDATE' ? 'Assessment Date' : '#'}}
                                            </div>
                                            <div ng-if="rule.relativeTo.reference === 'dynamic'">
                                                Vaccination ID # {{rule.relativeTo.id}}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td style="width : 200px;" ><strong> Latest Date </strong></td>
                            <td ng-if="fc.complete.type === 'fixed'">
                                {{fc.complete.date | date:'MM/dd/yyyy'}}
                            </td>
                            <td ng-if="fc.complete.type === 'relative'">
                                <table ng-if="fc.complete.rules">
                                    <tr ng-repeat="rule in fc.complete.rules track by $index">
                                        <td><span ng-if="$index !== 0"><strong>BUT NOT BEFORE</strong></span></td>
                                        <td>{{rule.year}} <strong>Years</strong></td>
                                        <td>{{rule.month}} <strong>Months</strong></td>
                                        <td>{{rule.day}} <strong>Days</strong></td>
                                        <td><strong>{{rule.position}}</strong></td>
                                        <td>
                                            <div ng-if="rule.relativeTo.reference === 'static'">
                                                {{rule.relativeTo.id === 'DOB' ? 'Birth' : rule.relativeTo.id === 'EVALDATE' ? 'Assessment Date' : '#'}}
                                            </div>
                                            <div ng-if="rule.relativeTo.reference === 'dynamic'">
                                                Vaccination ID # {{rule.relativeTo.id}}
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
            </md-content>
        </md-tab>
        <md-tab label="Reports">
            <md-content class="md-padding">
                <table ng-show="reportsFor(selectedTC.id).length > 0" class="table table-condensed table-striped table-hover">
                    <tr ng-repeat="item in reportsFor(selectedTC.id) track by $index">
                        <td>
                            <div style="width: 100%;" layout="row" layout-align="start center">
                                <div flex="50" layout="row" layout-align="center">
                                    <table style="width: 100%;">
                                        <tr>
                                            <td>Date</td>
                                            <td>{{::item.executionDate | date:'MM/dd/yyyy'}}</td>
                                        </tr>
                                        <tr>
                                            <td>Server</td>
                                            <td>{{::item.softwareConfig.endPoint}}</td>
                                        </tr>
                                        <tr>
                                            <td>Transport Type</td>
                                            <td>{{::item.softwareConfig.connector}}</td>
                                        </tr>
                                    </table>
                                </div>
                                <div flex="30" layout="column" class="unsaved" layout-align="center center">
                                    <div ng-show="changedTC(selectedTC,item)" flex>
                                        <i class="fa fa-exclamation-triangle "  aria-hidden="true"></i> TestCase has changed from the time this report was saved
                                    </div>
                                </div>
                                <div flex="20" layout="row" layout-align="end center">
                                    <div layout="column" layout-align="center">
                                        <button ng-click="deleteSavedReport(item,selectedTC.id,$index)" class="btn btn-xs btn-danger"  style="margin: 0px; margin-bottom: 5px;">
                                            <i class="fa fa-trash-o" style="font-size : 1.5em;" aria-hidden="true"></i> Delete
                                        </button>
                                        <button ng-click="showReport(item)" class="btn btn-xs btn-success"  style="margin: 0px;">
                                            <i class="fa fa-eye" style="font-size : 1.5em;" aria-hidden="true"></i> View
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
                <p ng-show="reportsFor(selectedTC.id).length == 0"  style="text-align: center; margin-top: 10px;"><strong>No report has been saved for this test case.</strong></p>
            </md-content>
        </md-tab>
    </md-tabs>
</md-content>